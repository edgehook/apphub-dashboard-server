import{i as G,d as g,f as k,Z as j,U as T,t as c,q as l,b as B,_ as H}from"./index-b6608134.js";import{d as L,bt as N,dm as D,ba as I,o as d,c as S,w as f,q as P,bB as U,bv as $,b8 as q,bA as F,e as J,bC as V,dn as M,dp as W}from"./.pnpm-ce7dda7b.js";import{g as Z}from"./plugin-744af617.js";import{u as z}from"./chartEditStore-0a96ea37.js";import{i as K}from"./icon-7d63310d.js";import{g as Q,s as X,a as Y,u as ee}from"./screenApi-6aa52476.js";import"./settingStore-07be61e1.js";const te=L({__name:"index",setup(se){const{t:n}=G.global,{BrowsersOutlineIcon:v,SendIcon:y,CardIcon:C}=K.ionicons5,p=z(),w=N(),{id:u}=w.params,o=typeof u=="string"?u:u[0],A=()=>{const s=k(j.CHART_PREVIEW_NAME,"href");if(!s)return;const e=p.getStorageInfo,t=T(c.GO_CHART_STORAGE_LIST)||[];if(t?.length){const r=t.findIndex(a=>a.id===o);r!==-1?(t.splice(r,1,{id:o,...e}),l(c.GO_CHART_STORAGE_LIST,t)):(t.push({id:o,...e}),l(c.GO_CHART_STORAGE_LIST,t))}else l(c.GO_CHART_STORAGE_LIST,[{id:o,...e}]);B(s,[o],void 0,!0)};let _=!1;const m=()=>{Q(o).then(s=>{if(s.code==200){_=s.data.state==0;return}})};m();const h=()=>{ee(o,_?1:0).then(e=>{e.code==200&&(window.$message.success(n("project.ExeSucceeded")),m())})},R=()=>{const s=window.location.href.split("#")[0]+"#/chart/release/"+o,e=n(_?"project.send":"project.cancelSend");Z({title:n("project.sendTitle"),message:s,positiveText:e,negativeText:n("project.copyUrl"),negativeButtonProps:{class:"copyUrl"},closeNegativeText:!1,onPositiveCallback:()=>{h()},onNegativeCallback:()=>{E(s)}})},E=async s=>{let e=new M(".copyUrl",{text:function(){return s}});e.on("success",t=>{window.$message.success(n("project.copySuccess")),e.destroy()}),e.on("error",t=>{e.destroy(),window.$message.success(n("project.copyFailed"))})},O=()=>{const s=p.getStorageInfo;let e="";const t=T(c.GO_CHART_STORAGE_LIST)||[];if(t?.length){const i=t.findIndex(x=>x.id===o);i!==-1?(t.splice(i,1,{id:o,...s}),l(c.GO_CHART_STORAGE_LIST,t)):(t.push({id:o,...s}),l(c.GO_CHART_STORAGE_LIST,t)),e=JSON.stringify(t)}else e=JSON.stringify([{id:o,...s}]);l(c.GO_SCREEN_DATA,e),X(o,e).then(i=>{i.code==200&&window.$message.success(n("project.saveSuccess"))});const r=document.querySelector(".go-edit-range"),a=document.getElementById("go-edit-watermark");p.getEditCanvas.scale,a.style.display="block",setTimeout(()=>{W(r,{backgroundColor:null,allowTaint:!0,useCORS:!0}).then(i=>{Y(o,i.toDataURL())})},600)},b=D([{select:!0,title:n("project.preview"),icon:g(v),event:A},{select:!0,title:n("project.save"),icon:g(C),event:O},{select:!0,title:n("project.send"),icon:g(y),event:R}]);return(s,e)=>{const t=I("n-button"),r=I("n-space");return d(),S(r,{class:"go-mt-0"},{default:f(()=>[(d(!0),P(V,null,U(J(b),a=>(d(),S(t,{key:a.title,ghost:"",onClick:a.event},{icon:f(()=>[(d(),S($(a.icon)))]),default:f(()=>[q("span",null,F(a.title),1)]),_:2},1032,["onClick"]))),128))]),_:1})}}});const de=H(te,[["__scopeId","data-v-07a98d12"]]);export{de as default};
