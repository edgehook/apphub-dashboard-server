import{bx as h,bK as Z,d as ee,bg as x,bz as te,ba as o,o as p,c as C,w as e,b6 as ne,b7 as oe,e as s,f as t,b8 as r,q,bB as U,bA as c,bC as I,bs as b,dq as se,bH as ae}from"./.pnpm-ce7dda7b.js";import{v as le,J as ie,i as ue,R as re,E as D,T as ce,au as de,_ as pe}from"./index-b6608134.js";import{i as H}from"./icon-7d63310d.js";import{T as L,D as S}from"./index-ce999aec.js";import{s as O}from"./index-54633a7f.js";import{r as fe,d as me}from"./file-6db2fad1.js";import{u as _e}from"./useTargetData.hook-ac6d967b.js";const ge=y=>{const l=h();return{uploadFileListRef:l,beforeUpload:({file:m})=>{l.value=[];const d=m.file.type;return d!==O.JSON&&d!==O.TXT?(window.$message.warning("仅支持上传 【JSON】 格式文件，请重新上传！"),!1):!0},customRequest:m=>{const{file:d}=m;Z(()=>{d.file?fe(d.file).then(i=>{y.value.option.dataset=le(i)}):window.$message.error("导入数据失败，请稍后重试或联系管理员！")})},download:()=>{try{window.$message.success("下载中，请耐心等待..."),me(ie(y.value.option.dataset),void 0,"json")}catch{window.$message.error("下载失败，数据错误！")}}}},ve=ee({__name:"index",props:{show:{type:Boolean,required:!1},ajax:{type:Boolean,required:!0}},setup(y){const{t:l}=ue.global,{targetData:f}=_e(),N=[l("setting.field"),l("setting.mapping"),l("setting.state")],{HelpOutlineIcon:k}=H.ionicons5,{DocumentAddIcon:m,DocumentDownloadIcon:d}=H.carbon,i=h(),A=h(),g=h(),T=h(!1),{uploadFileListRef:w,customRequest:j,beforeUpload:J,download:V}=ge(f);x(()=>f.value.request.requestDataType!==re.STATIC);const B=x(()=>f.value.chartConfig.chartFrame===D.ECHARTS),z=n=>{let u=S.SUCCESS;for(let _=0;_<i.value.length;_++)if(i.value[_][n]===void 0)return u=S.FAILURE,u;return S.SUCCESS},P=()=>{try{return A.value.map((n,u)=>u===0?{field:l("setting.unitId"),mapping:n,result:S.NULL}:{field:l("setting.dataItem")+`-${u}`,mapping:n,result:z(n)})}catch{return[]}};return te(()=>f.value?.option?.dataset,n=>{n&&f?.value?.chartConfig?.chartFrame===D.ECHARTS?(i.value=n,B.value&&(A.value=n.dimensions,g.value=P())):n!=null?(g.value=null,i.value=n):(T.value=!0,i.value="此组件无数据源"),ce(n)&&(g.value=null)},{immediate:!0}),(n,u)=>{const _=o("n-badge"),R=o("n-text"),v=o("n-space"),M=o("n-table"),F=o("n-timeline-item"),E=o("n-icon"),$=o("n-button"),G=o("n-upload"),K=o("n-tooltip"),X=o("n-code"),Q=o("n-card"),W=o("n-timeline");return p(),C(W,{class:"go-chart-configurations-timeline"},{default:e(()=>[ne(t(F,{type:"info",title:s(L).MAPPING},{default:e(()=>[t(M,{striped:""},{default:e(()=>[r("thead",null,[r("tr",null,[(p(),q(I,null,U(N,a=>r("th",{key:a},c(a),1)),64))])]),r("tbody",null,[(p(!0),q(I,null,U(g.value,(a,Y)=>(p(),q("tr",{key:Y},[r("td",null,c(a.field),1),r("td",null,c(a.mapping),1),r("td",null,[a.result===0?(p(),C(v,{key:0},{default:e(()=>[t(_,{dot:"",type:"success"}),t(R,null,{default:e(()=>[b(c(n.$t("setting.nothing")),1)]),_:1})]),_:1})):(p(),C(v,{key:1},{default:e(()=>[t(_,{dot:"",type:a.result===1?"success":"error"},null,8,["type"]),t(R,null,{default:e(()=>[b(c(a.result===1?n.$t("setting.success"):n.$t("setting.failed")),1)]),_:2},1024)]),_:2},1024))])]))),128))])]),_:1})]),_:1},8,["title"]),[[oe,s(B)&&g.value]]),t(F,{type:"success",title:s(L).CONTENT},{default:e(()=>[t(v,{vertical:""},{default:e(()=>[t(v,{class:"source-btn-box"},{default:e(()=>[t(G,{"file-list":s(w),"onUpdate:file-list":u[0]||(u[0]=a=>se(w)?w.value=a:null),"show-file-list":!1,customRequest:s(j),onBeforeUpload:s(J)},{default:e(()=>[t(v,null,{default:e(()=>[y.ajax?ae("",!0):(p(),C($,{key:0,class:"sourceBtn-item",disabled:T.value},{icon:e(()=>[t(E,null,{default:e(()=>[t(s(m))]),_:1})]),default:e(()=>[b(" "+c(n.$t("setting.import"))+"（json / txt） ",1)]),_:1},8,["disabled"]))]),_:1})]),_:1},8,["file-list","customRequest","onBeforeUpload"]),r("div",null,[t($,{class:"sourceBtn-item",disabled:T.value,onClick:s(V)},{icon:e(()=>[t(E,null,{default:e(()=>[t(s(d))]),_:1})]),default:e(()=>[b(" "+c(n.$t("setting.download")),1)]),_:1},8,["disabled","onClick"]),t(K,{trigger:"hover"},{trigger:e(()=>[t(E,{class:"go-ml-1",size:"21",depth:3},{default:e(()=>[t(s(k))]),_:1})]),default:e(()=>[t(R,{depth:"3"},{default:e(()=>[b(c(n.$t("setting.download_help")),1)]),_:1})]),_:1})])]),_:1}),t(Q,{size:"small"},{default:e(()=>[t(X,{code:s(de)(i.value),language:"json"},null,8,["code"])]),_:1})]),_:1})]),_:1},8,["title"])]),_:1})}}});const Re=pe(ve,[["__scopeId","data-v-b9ad4200"]]);export{Re as C};
