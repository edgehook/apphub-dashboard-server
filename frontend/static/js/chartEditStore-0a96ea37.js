import{n as v,be as U,bJ as G,bR as M}from"./.pnpm-ce7dda7b.js";import{R as b,y as H,z as B,B as q,D as F,E as Y,F as W,g as y,G as K,H as V,I as z,K as X,L as j,N as $,O as Q,Q as E,T as w,M as A}from"./index-b6608134.js";import{a as l,b as i,l as C}from"./plugin-744af617.js";import{u as J}from"./settingStore-07be61e1.js";var R=(t=>(t.ON_CLICK="click",t.ON_DBL_CLICK="dblclick",t.ON_MOUSE_ENTER="mouseenter",t.ON_MOUSE_LEAVE="mouseleave",t))(R||{}),N=(t=>(t.VNODE_MOUNTED="vnodeMounted",t.VNODE_BEFORE_MOUNT="vnodeBeforeMount",t))(N||{}),Z=(t=>(t.COMMOM="common",t))(Z||{});const tt={requestDataType:b.STATIC,requestHttpType:H.GET,requestUrl:"",requestInterval:void 0,requestIntervalUnit:B.SECOND,requestContentType:q.DEFAULT,requestParamsBodyType:F.NONE,requestSQLContent:{sql:"select * from  where"},requestParams:{Body:{"form-data":{},"x-www-form-urlencoded":{},json:"",xml:""},Header:{},Params:{}},apphubData:{deviceName:"",deviceId:"",ithingName:"",ithingId:"",module:"",type:"",propertys:[]}};class et{id=y();isGroup=!1;attr={...K,zIndex:-1};styles={filterShow:!1,hueRotate:0,saturate:1,contrast:1,brightness:1,opacity:1,rotateZ:0,rotateX:0,rotateY:0,skewX:0,skewY:0,blendMode:"normal",animations:[]};preview={overFlowHidden:!1};status={lock:!1,hide:!1};request=v(tt);filter=void 0;events={baseEvent:{[R.ON_CLICK]:void 0,[R.ON_DBL_CLICK]:void 0,[R.ON_MOUSE_ENTER]:void 0,[R.ON_MOUSE_LEAVE]:void 0},advancedEvents:{[N.VNODE_MOUNTED]:void 0,[N.VNODE_BEFORE_MOUNT]:void 0}}}class st extends et{isGroup=!0;chartConfig={key:"group",chartKey:"group",conKey:"group",category:"group",categoryName:"group",package:"group",chartFrame:Y.COMMON,title:W,image:""};groupList=[];key="group";option={};id=y();attr={w:0,h:0,x:0,y:0,offsetX:0,offsetY:0,zIndex:-1}}var o=(t=>(t.ADD="add",t.DELETE="delete",t.UPDATE="update",t.MOVE="move",t.COPY="copy",t.CUT="cut",t.PASTE="paste",t.TOP="top",t.BOTTOM="bottom",t.UP="up",t.DOWN="down",t.GROUP="group",t.UN_GROUP="unGroup",t.LOCK="lock",t.UNLOCK="unLock",t.HIDE="hide",t.SHOW="show",t))(o||{}),u=(t=>(t.CANVAS="canvas",t.CHART="chart",t))(u||{}),D=(t=>(t.ID="id",t.TARGET_TYPE="targetType",t.ACTION_TYPE="actionType",t.HISTORY_DATA="historyData",t))(D||{});const rt=U({id:"useChartHistoryStore",state:()=>({backStack:[],forwardStack:[]}),getters:{getBackStack(){return this.backStack},getForwardStack(){return this.forwardStack}},actions:{createStackItem(t,s,e=u.CHART){this.pushBackStackItem(Object.freeze({[D.ID]:new Date().getTime().toString(),[D.HISTORY_DATA]:t,[D.ACTION_TYPE]:s,[D.TARGET_TYPE]:e}))},canvasInit(t){this.createStackItem([t],o.ADD,u.CANVAS)},pushBackStackItem(t,s=!1){t instanceof Array?this.backStack=[...this.backStack,...t]:this.backStack.push(t),this.backStack.splice(0,this.backStack.length-V),!s&&this.clearForwardStack()},pushForwardStack(t){t instanceof Array?this.forwardStack=[...this.forwardStack,...t]:this.forwardStack.push(t)},popBackStackItem(){if(this.backStack.length>0)return this.backStack.pop()},popForwardStack(){if(this.forwardStack.length>0)return this.forwardStack.pop()},clearForwardStack(){this.forwardStack=[]},clearBackStack(){const t=this.getBackStack[0];this.backStack=[t]},backAction(){try{if(l(),this.getBackStack.length>1){const t=this.popBackStackItem();if(!t){i();return}return this.pushForwardStack(t),i(),t}i()}catch{C()}},forwardAction(){try{if(l(),this.getForwardStack.length){const t=this.popForwardStack();if(!t){i();return}return this.pushBackStackItem(t,!0),i(),t}i()}catch{C()}},createAddHistory(t){this.createStackItem(t,o.ADD,u.CHART)},createUpdateHistory(t){this.createStackItem(t,o.UPDATE,u.CHART)},createDeleteHistory(t){this.createStackItem(t,o.DELETE,u.CHART)},createMoveHistory(t){this.createStackItem(t,o.MOVE,u.CHART)},createLayerHistory(t,s){this.createStackItem(t,s,u.CHART)},createPasteHistory(t){this.createStackItem(t,o.CUT,u.CHART)},createGroupHistory(t){this.createStackItem(t,o.GROUP,u.CHART)},createUnGroupHistory(t){this.createStackItem(t,o.UN_GROUP,u.CHART)},createLockHistory(t){this.createStackItem(t,o.LOCK,u.CHART)},createUnLockHistory(t){this.createStackItem(t,o.UNLOCK,u.CHART)},createHideHistory(t){this.createStackItem(t,o.HIDE,u.CHART)},createShowHistory(t){this.createStackItem(t,o.SHOW,u.CHART)}}});var P=(t=>(t.EDIT_LAYOUT_DOM="editLayoutDom",t.EDIT_CONTENT_DOM="editContentDom",t.OFFSET="offset",t.SCALE="scale",t.USER_SCALE="userScale",t.LOCK_SCALE="lockScale",t.IS_CREATE="isCreate",t.IS_DRAG="isDrag",t.IS_SELECT="isSelect",t))(P||{}),at=(t=>(t.PROJECT_NAME="projectName",t.WIDTH="width",t.HEIGHT="height",t.CHART_THEME_COLOR="chartThemeColor",t.CHART_THEME_SETTING="chartThemeSetting",t.BACKGROUND="background",t.BACKGROUND_IMAGE="backgroundImage",t.SELECT_COLOR="selectColor",t.PREVIEW_SCALE_TYPE="previewScaleType",t))(at||{}),P=(t=>(t.START_X="startX",t.START_Y="startY",t.X="x",t.Y="y",t))(P||{}),_=(t=>(t.EDIT_RANGE="editRange",t.EDIT_CANVAS="editCanvas",t.RIGHT_MENU_SHOW="rightMenuShow",t.MOUSE_POSITION="mousePosition",t.TARGET_CHART="targetChart",t.RECORD_CHART="recordChart",t.EDIT_CANVAS_CONFIG="editCanvasConfig",t.REQUEST_GLOBAL_CONFIG="requestGlobalConfig",t.COMPONENT_LIST="componentList",t))(_||{});const f=rt(),ot=J(),gt=U({id:"useChartEditStore",state:()=>({editCanvas:{editLayoutDom:null,editContentDom:null,offset:20,scale:1,userScale:1,lockScale:!1,isCreate:!1,isDrag:!1,isSelect:!1},rightMenuShow:!1,mousePosition:{startX:0,startY:0,x:0,y:0},targetChart:{hoverId:void 0,selectId:[]},recordChart:void 0,editCanvasConfig:{projectName:void 0,width:1920,height:1080,filterShow:!1,hueRotate:0,saturate:1,contrast:1,brightness:1,opacity:1,rotateZ:0,rotateX:0,rotateY:0,skewX:0,skewY:0,blendMode:"normal",background:void 0,backgroundImage:void 0,selectColor:!0,chartThemeColor:z,chartThemeSetting:X,previewScaleType:j},requestGlobalConfig:{requestDataPond:[],requestOriginUrl:window.location.origin,requestInterval:$,requestIntervalUnit:Q,requestParams:{Body:{"form-data":{},"x-www-form-urlencoded":{},json:"",xml:""},Header:{},Params:{}},count:0,range:"10min",timeRange:[1697472e6,Date.now()]},componentList:[]}),getters:{getMousePosition(){return this.mousePosition},getRightMenuShow(){return this.rightMenuShow},getEditCanvas(){return this.editCanvas},getEditCanvasConfig(){return this.editCanvasConfig},getTargetChart(){return this.targetChart},getRecordChart(){return this.recordChart},getRequestGlobalConfig(){return this.requestGlobalConfig},getComponentList(){return this.componentList},getStorageInfo(){return{[_.EDIT_CANVAS_CONFIG]:this.getEditCanvasConfig,[_.COMPONENT_LIST]:this.getComponentList,[_.REQUEST_GLOBAL_CONFIG]:this.getRequestGlobalConfig}}},actions:{setEditCanvas(t,s){this.editCanvas[t]=s},setEditCanvasConfig(t,s){this.editCanvasConfig[t]=s},setRightMenuShow(t){this.rightMenuShow=t},setTargetHoverChart(t){this.targetChart.hoverId=t},setTargetSelectChart(t,s=!1){if(!this.targetChart.selectId.find(e=>e===t)){if(!t){this.targetChart.selectId=[];return}if(s){if(E(t)){this.targetChart.selectId.push(t);return}if(w(t)){this.targetChart.selectId.push(...t);return}}else{if(E(t)){this.targetChart.selectId=[t];return}if(w(t)){this.targetChart.selectId=t;return}}}},setRecordChart(t){this.recordChart=v(t)},setMousePosition(t,s,e,r){t&&(this.mousePosition.x=t),s&&(this.mousePosition.y=s),e&&(this.mousePosition.startX=e),r&&(this.mousePosition.startY=r)},fetchTargetIndex(t){const s=t||this.getTargetChart.selectId.length&&this.getTargetChart.selectId[0]||void 0;if(!s)return i(),-1;const e=this.componentList.findIndex(r=>r.id===s);if(e!==-1)return e;{const r=this.getComponentList.length;for(let a=0;a<r;a++)if(this.getComponentList[a].isGroup){for(const h of this.getComponentList[a].groupList)if(h.id===s)return a}}return-1},idPreFormat(t){const s=[];return t?(E(t)&&s.push(t),w(t)&&s.push(...t),s):(s.push(...this.getTargetChart.selectId),s)},addComponentList(t,s=!1,e=!1){if(t instanceof Array){t.forEach(r=>{this.addComponentList(r,s,e)});return}if(e&&f.createAddHistory([t]),s){this.componentList.unshift(t);return}this.componentList.push(t)},removeComponentList(t,s=!0){try{const e=this.idPreFormat(t),r=[];if(!e.length)return;l(),e.forEach(a=>{const h=this.fetchTargetIndex(a);h!==-1&&(r.push(this.getComponentList[h]),this.componentList.splice(h,1))}),s&&f.createDeleteHistory(r),i();return}catch{C()}},resetComponentPosition(t,s){const e=this.fetchTargetIndex(t.id);if(e>-1){const r=this.getComponentList[e];s?r.attr=Object.assign(r.attr,{x:t.attr.x+t.attr.offsetX,y:t.attr.y+t.attr.offsetY}):r.attr=Object.assign(r.attr,{x:t.attr.x,y:t.attr.y})}},moveComponentList(t){f.createMoveHistory(t)},updateComponentList(t,s){t<1&&t>this.getComponentList.length||(this.componentList[t]=s)},setPageStyle(t,s){const e=this.getEditCanvas.editContentDom;e&&(e.style[t]=s)},setBothEnds(t=!1,s=!0){try{if(this.getTargetChart.selectId.length>1)return;l();const e=this.getComponentList.length;if(e<2){i();return}const r=this.fetchTargetIndex(),a=this.getComponentList[r];if(r!==-1){if(t&&r===0||!t&&r===e-1){i();return}const h=(g,d)=>{const n=v(g);return n.attr.zIndex=d,n};s&&f.createLayerHistory([h(a,r)],t?o.BOTTOM:o.TOP),this.addComponentList(a,t),this.getComponentList.splice(t?r+1:r,1),i();return}}catch{C()}},setTop(t=!0){this.setBothEnds(!1,t)},setBottom(t=!0){this.setBothEnds(!0,t)},wrap(t=!1,s=!0){try{if(this.getTargetChart.selectId.length>1)return;l();const e=this.getComponentList.length;if(e<2){i();return}const r=this.fetchTargetIndex();if(r!==-1){if(t&&r===0||!t&&r===e-1){i();return}const a=t?r-1:r+1,h=this.getComponentList[r],g=this.getComponentList[a];s&&f.createLayerHistory([h],t?o.DOWN:o.UP),this.updateComponentList(r,g),this.updateComponentList(a,h),i();return}}catch{C()}},setUp(t=!0){this.wrap(!1,t)},setDown(t=!0){this.wrap(!0,t)},setCopy(t=!1){try{if(this.getTargetChart.selectId.length>1||document.getElementsByClassName("n-modal-body-wrapper").length)return;l();const s=this.fetchTargetIndex();if(s!==-1){const e={charts:this.getComponentList[s],type:t?o.CUT:o.COPY};this.setRecordChart(e),window.$message.success(t?"剪切图表成功":"复制图表成功！"),i()}}catch{C()}},setCut(){this.setCopy(!0)},setParse(){try{l();const t=this.getRecordChart;if(t===void 0){i();return}const s=a=>(a=v(a),a.attr.x=this.getMousePosition.x+30,a.attr.y=this.getMousePosition.y+30,a.id=y(),a.isGroup&&a.groupList.forEach(h=>{h.id=y()}),a),e=t.type===o.CUT;(Array.isArray(t.charts)?t.charts:[t.charts]).forEach(a=>{this.addComponentList(s(a),void 0,!0),e&&(this.setTargetSelectChart(a.id),this.removeComponentList(void 0,!0))}),e&&this.setRecordChart(void 0),i()}catch{C()}},setBackAndSetForwardHandle(t,s=!1){if(t.targetType===u.CANVAS){this.editCanvas=t.historyData[0];return}this.setTargetSelectChart();let e=t.historyData;w(e)&&e.forEach(c=>{this.setTargetSelectChart(c.id,!0)});const r=t.actionType===o.ADD,a=t.actionType===o.DELETE;if(r||a){if(r&&s||a&&!s){e.forEach(c=>{this.addComponentList(c)});return}e.forEach(c=>{this.removeComponentList(c.id,!1)});return}if(t.actionType===o.MOVE){e.forEach(c=>{this.resetComponentPosition(c,s)});return}const g=t.actionType===o.TOP,d=t.actionType===o.BOTTOM;if(g||d){if(!s){g&&this.getComponentList.pop(),d&&this.getComponentList.shift(),this.getComponentList.splice(e[0].attr.zIndex,0,e[0]);return}g&&this.setTop(!1),d&&this.setBottom(!1)}const n=t.actionType===o.UP,p=t.actionType===o.DOWN;if(n||p){if(n&&s||p&&!s){this.setUp(!1);return}this.setDown(!1);return}const T=t.actionType===o.GROUP,S=t.actionType===o.UN_GROUP;if(T||S){if(T&&s||S&&!s){const c=[];e.length>1?e.forEach(m=>{c.push(m.id)}):e[0].groupList.forEach(x=>{c.push(x.id)}),this.setGroup(c,!1);return}e.length>1?this.setUnGroup([e[0].id],void 0,!1):this.setUnGroup([e[0].groupList[0].id],void 0,!1);return}const L=t.actionType===o.LOCK,k=t.actionType===o.UNLOCK;if(L||k){if(L&&s||k&&!s){e.forEach(c=>{this.setLock(!c.status.lock,!1)});return}e.forEach(c=>{this.setUnLock(!1)});return}const O=t.actionType===o.HIDE,I=t.actionType===o.SHOW;if(O||I){if(O&&s||I&&!s){e.forEach(c=>{this.setHide(!c.status.hide,!1)});return}e.forEach(c=>{this.setShow(!1)});return}},setBack(){try{l();const t=f.backAction();if(!t){i();return}this.setBackAndSetForwardHandle(t),i()}catch{C()}},setForward(){try{l();const t=f.forwardAction();if(!t){i();return}this.setBackAndSetForwardHandle(t,!0),i()}catch{C()}},setMove(t){const s=this.fetchTargetIndex();if(s===-1)return;const e=this.getComponentList[s].attr,r=ot.getChartMoveDistance;switch(t){case A.ARROW_UP:e.y-=r;break;case A.ARROW_RIGHT:e.x+=r;break;case A.ARROW_DOWN:e.y+=r;break;case A.ARROW_LEFT:e.x-=r;break}},setGroup(t,s=!0){try{const e=this.idPreFormat(t)||this.getTargetChart.selectId;if(e.length<2)return;l();const r=new st,a={l:this.getEditCanvasConfig.width,t:this.getEditCanvasConfig.height,r:0,b:0},h=[],g=[],d=[];e.forEach(n=>{const p=this.fetchTargetIndex(n);p!==-1&&this.getComponentList[p].isGroup?this.setUnGroup([n],T=>{T.forEach(S=>{this.addComponentList(S),d.push(S.id)})},!1):p!==-1&&d.push(n)}),d.forEach(n=>{const p=this.componentList.splice(this.fetchTargetIndex(n),1)[0],{x:T,y:S,w:L,h:k}=p.attr,{l:O,t:I,r:c,b:m}=a;a.l=O>T?T:O,a.t=I>S?S:I,a.r=c<T+L?T+L:c,a.b=m<S+k?S+k:m,h.push(p),g.push(G(p))}),s&&f.createGroupHistory(g),h.forEach(n=>{n.attr.x=n.attr.x-a.l,n.attr.y=n.attr.y-a.t,r.groupList.push(n)}),r.attr.x=a.l,r.attr.y=a.t,r.attr.w=a.r-a.l,r.attr.h=a.b-a.t,this.addComponentList(r),this.setTargetSelectChart(r.id),i()}catch(e){console.log(e),window.$message.error("创建分组失败，请联系管理员！"),i()}},setUnGroup(t,s,e=!0){try{const r=t||this.getTargetChart.selectId;if(r.length!==1)return;l();const a=g=>{const d=this.getComponentList[g];d.isGroup&&(e&&f.createUnGroupHistory(v([d])),d.groupList.forEach(n=>{n.attr.x=n.attr.x+d.attr.x,n.attr.y=n.attr.y+d.attr.y,s||this.addComponentList(n)}),this.setTargetSelectChart(d.id),this.removeComponentList(d.id,!1),s&&s(d.groupList))},h=this.fetchTargetIndex(r[0]);h!==-1&&a(h),i()}catch(r){console.log(r),window.$message.error("解除分组失败，请联系管理员！"),i()}},setLock(t=!0,s=!0){try{if(this.getTargetChart.selectId.length>1)return;l();const e=this.fetchTargetIndex();if(e!==-1){const r=this.getComponentList[e];r.status.lock=t,s&&(t?f.createLockHistory([r]):f.createUnLockHistory([r])),this.updateComponentList(e,r),t&&this.setTargetSelectChart(void 0),i();return}}catch{C()}},setUnLock(t=!0){this.setLock(!1,t)},setHide(t=!0,s=!0){try{if(this.getTargetChart.selectId.length>1)return;l();const e=this.fetchTargetIndex();if(e!==-1){const r=this.getComponentList[e];r.status.hide=t,s&&(t?f.createHideHistory([r]):f.createShowHistory([r])),this.updateComponentList(e,r),i(),t&&this.setTargetSelectChart(void 0)}}catch{C()}},setShow(t=!0){this.setHide(!1,t)},setPageSize(t){this.setPageStyle("height",`${this.editCanvasConfig.height*t}px`),this.setPageStyle("width",`${this.editCanvasConfig.width*t}px`)},computedScale(){if(this.getEditCanvas.editLayoutDom){const t=this.getEditCanvas.editLayoutDom.clientWidth-this.getEditCanvas.offset*2-5,s=this.getEditCanvas.editLayoutDom.clientHeight-this.getEditCanvas.offset*4,e=this.editCanvasConfig.width,r=this.editCanvasConfig.height,a=parseFloat((e/r).toFixed(5));if(parseFloat((t/s).toFixed(5))>a){const g=parseFloat((s*a/e).toFixed(5));this.setScale(g>1?1:g)}else{const g=parseFloat((t/a/r).toFixed(5));this.setScale(g>1?1:g)}}else window.$message.warning("请先创建画布，再进行缩放")},listenerScale(){const t=M(this.computedScale,200);return t(),window.addEventListener("resize",t),()=>{window.removeEventListener("resize",t)}},setScale(t,s=!1){(!this.getEditCanvas.lockScale||s)&&(this.setPageSize(t),this.getEditCanvas.userScale=t,this.getEditCanvas.scale=t)}}});export{R as B,_ as C,N as E,Z as I,st as P,rt as a,at as b,et as c,P as d,tt as r,gt as u};
