import{d as x,bf as ee,bx as T,bD as se,bz as re,ba as s,o as k,c as E,w as o,f as a,bs as b,bA as y,e,dq as $,bH as K,ds as pe,bg as Q,eG as de,ew as me,q as fe,b8 as V,bC as ve,bJ as W}from"./.pnpm-ce7dda7b.js";import{u as ge,a8 as ce,a9 as he,_ as be}from"./index-b6608134.js";import{i as ye}from"./icon-7d63310d.js";import{S as p,t as S}from"./index-54633a7f.js";import{g as qe,a as X,b as Y,c as Z}from"./deviceApi-ee3669b6.js";import{u as te}from"./useTargetData.hook-ac6d967b.js";import{b as P,c as De,d as Ce,e as _e}from"./index-ce999aec.js";import{C as Ie}from"./index-f2232116.js";import"./chartEditStore-0a96ea37.js";import"./plugin-744af617.js";import"./settingStore-07be61e1.js";import"./index-18fcb4c8.js";import"./index.vue_vue_type_script_setup_true_lang-b36c4261.js";import"./file-6db2fad1.js";const we=x({__name:"index",props:{modelShow:Boolean},emits:["update:modelShow","sendHandle"],setup(j,{emit:I}){const H=j,{targetData:t,chartEditStore:m}=te(),{requestOriginUrl:d,requestInterval:w,requestIntervalUnit:g,range:c,timeRange:D}=ee(m.getRequestGlobalConfig),C=T(!1),r=se({deviceOptions:[],ithingOptions:[],moduleOptions:[],propertyOptions:[]});let U=t.value.request.apphubData.deviceId,O=t.value.request.apphubData.ithingId,A=t.value.request.apphubData.module,_=t.value.request.apphubData.propertys,u=t.value.request.apphubData.type,h=t.value.request.apphubData.funcId;const q=()=>{qe(d.value).then(n=>{n.code==200&&Array.isArray(n.data)&&(r.deviceOptions=n.data)})},R=(n,l)=>{t.value.request.apphubData.deviceName=l.label,t.value.request.apphubData.ithingId="",t.value.request.apphubData.module="",t.value.request.apphubData.propertys=[],t.value.request.apphubData.funcId="",X(d.value,n).then(f=>{f.code==200&&Array.isArray(f.data)&&(r.ithingOptions=f.data)})},M=(n,l)=>{t.value.request.apphubData.ithingName=l.label,t.value.request.apphubData.module="",t.value.request.apphubData.propertys=[],t.value.request.apphubData.funcId="",Y(d.value,n).then(f=>{f.code==200&&Array.isArray(f.data)&&(r.moduleOptions=f.data)})},B=n=>{t.value.request.apphubData.propertys=[],t.value.request.apphubData.funcId="",Z(d.value,t.value.request.apphubData.ithingId,n).then(l=>{l.code==200&&Array.isArray(l.data)&&(r.propertyOptions=l.data)})},N=n=>{t.value.request.apphubData.funcId=""},z=()=>{t.value.request.apphubData.deviceId!=""&&(X(d.value,t.value.request.apphubData.deviceId).then(n=>{n.code==200&&Array.isArray(n.data)&&(r.ithingOptions=n.data)}),t.value.request.apphubData.ithingId!=""&&(Y(d.value,t.value.request.apphubData.ithingId).then(n=>{n.code==200&&Array.isArray(n.data)&&(r.moduleOptions=n.data)}),t.value.request.apphubData.module!=""&&Z(d.value,t.value.request.apphubData.ithingId,t.value.request.apphubData.module).then(n=>{n.code==200&&Array.isArray(n.data)&&(r.propertyOptions=n.data)})))};q(),z(),re(()=>H.modelShow,n=>{C.value=n});const F=()=>{I("update:modelShow",!1),I("sendHandle"),U=t.value.request.apphubData.deviceId,O=t.value.request.apphubData.ithingId,A=t.value.request.apphubData.module,_=t.value.request.apphubData.propertys,u=t.value.request.apphubData.type,h=t.value.request.apphubData.funcId},ae=()=>{I("update:modelShow",!1),t.value.request.apphubData.deviceId=U,t.value.request.apphubData.ithingId=O,t.value.request.apphubData.module=A,t.value.request.apphubData.propertys=_,t.value.request.apphubData.type=u,t.value.request.apphubData.funcId=h};return(n,l)=>{const f=s("n-tag"),ne=s("n-input"),G=s("n-input-number"),v=s("n-select"),L=s("n-input-group"),le=s("n-date-picker"),J=s("n-button"),oe=s("n-space"),ue=s("n-card"),ie=s("n-modal");return k(),E(ie,{class:"go-chart-data-pond-control",show:C.value,"onUpdate:show":l[15]||(l[15]=i=>C.value=i),"mask-closable":!1},{default:o(()=>[a(ue,{bordered:!1,role:"dialog",size:"small","aria-modal":"true",style:{width:"900px",height:"800px"}},{action:o(()=>[a(oe,{justify:"end"},{default:o(()=>[a(J,{type:"info",onClick:ae},{default:o(()=>[b(y(n.$t("editConfig.cancel")),1)]),_:1}),a(J,{type:"primary",onClick:F},{default:o(()=>[b(y(n.$t("editConfig.save")),1)]),_:1})]),_:1})]),default:o(()=>[a(f,{type:"info",bordered:!1,style:{"border-radius":"5px"}},{default:o(()=>[b(y(n.$t("editConfig.globalPublicConfig")),1)]),_:1}),a(e(p),{name:n.$t("editConfig.serverAddress"),itemRightStyle:{gridTemplateColumns:"5fr 2fr 1fr"}},{default:o(()=>[a(e(S),{name:n.$t("editConfig.frontUrl")},{default:o(()=>[a(ne,{value:e(d),"onUpdate:value":l[0]||(l[0]=i=>$(d)?d.value=i:null),valueModifiers:{trim:!0},placeholder:"http://127.0.0.1:8082/",onBlur:q},null,8,["value"])]),_:1},8,["name"]),a(e(S),{name:n.$t("editConfig.intervalDescription")},{default:o(()=>[a(L,null,{default:o(()=>[a(G,{class:"select-time-number",value:e(w),"onUpdate:value":l[1]||(l[1]=i=>$(w)?w.value=i:null),valueModifiers:{trim:!0},min:"0","show-button":!1,placeholder:n.$t("editConfig.requestIntervalPlaceholder")},null,8,["value","placeholder"]),a(v,{class:"select-time-options",value:e(g),"onUpdate:value":l[2]||(l[2]=i=>$(g)?g.value=i:null),options:e(P)},null,8,["value","options"])]),_:1})]),_:1},8,["name"])]),_:1},8,["name"]),a(e(p),{name:n.$t("editConfig.timeRange"),itemRightStyle:{gridTemplateColumns:"5fr 1fr"}},{default:o(()=>[a(v,{class:"select-time-options",value:e(c),"onUpdate:value":l[3]||(l[3]=i=>$(c)?c.value=i:null),options:e(De)},null,8,["value","options"])]),_:1},8,["name"]),a(e(p),{itemRightStyle:{gridTemplateColumns:"5fr 1fr"}},{default:o(()=>[e(c)=="custom"?(k(),E(le,{key:0,value:e(D),"onUpdate:value":l[4]||(l[4]=i=>$(D)?D.value=i:null),type:"datetimerange",clearable:""},null,8,["value"])):K("",!0)]),_:1}),a(f,{type:"info",bordered:!1,style:{"border-radius":"5px"}},{default:o(()=>[b(y(n.$t("editConfig.AppHubConfig")),1)]),_:1}),a(e(p),{name:n.$t("editConfig.device"),itemLeftStyle:{width:"80px"},itemRightStyle:{gridTemplateColumns:"5fr 1fr"}},{default:o(()=>[a(v,{class:"select-time-options",value:e(t).request.apphubData.deviceId,"onUpdate:value":[l[5]||(l[5]=i=>e(t).request.apphubData.deviceId=i),R],options:r.deviceOptions},null,8,["value","options"])]),_:1},8,["name"]),a(e(p),{name:n.$t("editConfig.subDevice"),itemRightStyle:{gridTemplateColumns:"5fr 1fr"},itemLeftStyle:{width:"80px"}},{default:o(()=>[a(v,{class:"select-time-options",value:e(t).request.apphubData.ithingId,"onUpdate:value":[l[6]||(l[6]=i=>e(t).request.apphubData.ithingId=i),M],options:r.ithingOptions},null,8,["value","options"])]),_:1},8,["name"]),a(e(p),{name:n.$t("editConfig.module"),itemRightStyle:{gridTemplateColumns:"5fr 1fr"},itemLeftStyle:{width:"80px"}},{default:o(()=>[a(v,{class:"select-time-options",value:e(t).request.apphubData.module,"onUpdate:value":[l[7]||(l[7]=i=>e(t).request.apphubData.module=i),B],options:r.moduleOptions},null,8,["value","options"])]),_:1},8,["name"]),a(e(p),{name:n.$t("editConfig.property"),itemRightStyle:{gridTemplateColumns:"5fr 1fr"},itemLeftStyle:{width:"80px"}},{default:o(()=>[a(v,{class:"select-time-options",value:e(t).request.apphubData.propertys,"onUpdate:value":[l[8]||(l[8]=i=>e(t).request.apphubData.propertys=i),N],multiple:"",options:r.propertyOptions},null,8,["value","options"])]),_:1},8,["name"]),a(e(p),{name:n.$t("editConfig.type"),itemRightStyle:{gridTemplateColumns:"5fr 1fr"},itemLeftStyle:{width:"80px"}},{default:o(()=>[a(v,{class:"select-time-options",value:e(t).request.apphubData.type,"onUpdate:value":l[9]||(l[9]=i=>e(t).request.apphubData.type=i),options:e(Ce)},null,8,["value","options"])]),_:1},8,["name"]),a(e(p),{name:n.$t("editConfig.aggregation"),itemRightStyle:{gridTemplateColumns:"3fr 2fr 1fr"},itemLeftStyle:{width:"80px"}},{default:o(()=>[a(e(S),{name:n.$t("editConfig.aggregateFunction")},{default:o(()=>[a(v,{class:"select-time-options",value:e(t).request.apphubData.funcId,"onUpdate:value":l[10]||(l[10]=i=>e(t).request.apphubData.funcId=i),options:e(_e)},null,8,["value","options"])]),_:1},8,["name"]),e(t).request.apphubData.funcId!=="ORIGIN"?(k(),E(e(S),{key:0,name:n.$t("editConfig.timeGroup")},{default:o(()=>[a(L,null,{default:o(()=>[a(G,{value:e(t).request.apphubData.groupBy,"onUpdate:value":l[11]||(l[11]=i=>e(t).request.apphubData.groupBy=i),valueModifiers:{trim:!0},class:"select-time-number",min:"0","show-button":!1,placeholder:n.$t("editConfig.groupTime")},null,8,["value","placeholder"]),a(v,{class:"select-time-options",value:e(t).request.apphubData.groupByUnit,"onUpdate:value":l[12]||(l[12]=i=>e(t).request.apphubData.groupByUnit=i),options:e(P)},null,8,["value","options"])]),_:1})]),_:1},8,["name"])):K("",!0)]),_:1},8,["name"]),a(e(p),{name:n.$t("editConfig.interval"),itemRightStyle:{gridTemplateColumns:"5fr 1fr"},itemLeftStyle:{width:"80px"}},{default:o(()=>[a(e(S),{name:n.$t("editConfig.intervalDescription")},{default:o(()=>[a(L,null,{default:o(()=>[a(G,{value:e(t).request.requestInterval,"onUpdate:value":l[13]||(l[13]=i=>e(t).request.requestInterval=i),valueModifiers:{trim:!0},class:"select-time-number",min:"0","show-button":!1,placeholder:n.$t("editConfig.requestIntervalPlaceholder1")},null,8,["value","placeholder"]),a(v,{class:"select-time-options",value:e(t).request.requestIntervalUnit,"onUpdate:value":l[14]||(l[14]=i=>e(t).request.requestIntervalUnit=i),options:e(P)},null,8,["value","options"])]),_:1})]),_:1},8,["name"])]),_:1},8,["name"])]),_:1})]),_:1},8,["show"])}}}),$e={class:"go-chart-data-pond"},Se={class:"go-absolute-center"},Ue=x({__name:"index",setup(j){pe(u=>({"134585ae":e(O)}));const I=ge(),{HelpOutlineIcon:H,FlashIcon:t}=ye.ionicons5,{targetData:m,chartEditStore:d}=te(),{requestOriginUrl:w}=ee(d.getRequestGlobalConfig),g=T(!1),c=T(!1),D=T(!1);let C=0,r;const U=Q(()=>{var u="";for(let h of m.value.request.apphubData.propertys)u==""?u=h:u=u+"&&"+h;return u}),O=Q(()=>I.getAppTheme),A=()=>{c.value=!0},_=async()=>{if(!m.value?.request){window.$message.warning("请选择一个公共接口！");return}g.value=!0;try{const u=await ce(W(m.value.request),W(d.getRequestGlobalConfig));if(g.value=!1,u){!u?.data&&!m.value.filter&&window.$message.warning("您的数据不符合默认格式，请配置过滤器！"),m.value.option.dataset=he(u?.data,u,m.value.filter),D.value=!0;return}window.$message.warning("数据异常，请检查参数！")}catch{g.value=!1,window.$message.warning("数据异常，请检查参数！")}};return de(()=>{const u=m.value?.filter;r!==u&&C&&(r=u,_()),C++}),me(()=>{r=null}),(u,h)=>{const q=s("n-input"),R=s("n-button"),M=s("n-card"),B=s("n-icon"),N=s("n-tooltip"),z=s("go-skeleton");return k(),fe(ve,null,[V("div",$e,[a(M,{class:"n-card-shallow"},{default:o(()=>[a(e(p),{name:u.$t("editConfig.serverAddress"),alone:!0},{default:o(()=>[a(q,{size:"small",placeholder:e(w)||u.$t("editConfig.none"),disabled:!0},null,8,["placeholder"])]),_:1},8,["name"]),a(e(p),{name:u.$t("editConfig.device"),alone:!0},{default:o(()=>[a(q,{size:"small",placeholder:e(m).request.apphubData.deviceName||u.$t("editConfig.none"),disabled:!0},null,8,["placeholder"])]),_:1},8,["name"]),a(e(p),{name:u.$t("editConfig.subDevice"),alone:!0},{default:o(()=>[a(q,{size:"small",placeholder:e(m).request.apphubData.ithingName||u.$t("editConfig.none"),disabled:!0},null,8,["placeholder"])]),_:1},8,["name"]),a(e(p),{name:u.$t("editConfig.property"),alone:!0},{default:o(()=>[a(q,{size:"small",placeholder:e(U)||u.$t("editConfig.none"),disabled:!0},null,8,["placeholder"])]),_:1},8,["name"]),V("div",{class:"edit-text",onClick:A},[V("div",Se,[a(R,{type:"primary",secondary:""},{default:o(()=>[b(y(u.$t("editConfig.editConfig")),1)]),_:1})])])]),_:1})]),a(e(p),{alone:!0},{name:o(()=>[b(y(u.$t("editConfig.test"))+" ",1),a(N,{trigger:"hover"},{trigger:o(()=>[a(B,{size:"21",depth:3},{default:o(()=>[a(e(H))]),_:1})]),default:o(()=>[b(" "+y(u.$t("editConfig.tooltip")),1)]),_:1})]),default:o(()=>[a(R,{type:"primary",ghost:"",onClick:_},{icon:o(()=>[a(B,null,{default:o(()=>[a(e(t))]),_:1})]),default:o(()=>[b(" "+y(u.$t("editConfig.sendRequest")),1)]),_:1})]),_:1}),a(e(Ie),{show:D.value&&!g.value,ajax:!0},null,8,["show"]),a(z,{load:g.value,repeat:3},null,8,["load"]),a(e(we),{modelShow:c.value,"onUpdate:modelShow":h[0]||(h[0]=F=>c.value=F),onSendHandle:_},null,8,["modelShow"])],64)}}});const Ve=be(Ue,[["__scopeId","data-v-84247469"]]);export{Ve as default};
