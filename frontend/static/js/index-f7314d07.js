import{M as k}from"./EditorWorker-ca19246c.js";import{d as E,bx as N,q as O,f as t,w as n,ba as o,o as u,b8 as T,e as r,c as V,bH as B,bs as c}from"./.pnpm-ce7dda7b.js";import{S as m,q as I,t as J,J as p,v as A,s as F,_ as L}from"./index-b6608134.js";import{g as P}from"./storage-7eeb2676.js";import{i as R}from"./icon-7d63310d.js";import"./chartEditStore-0a96ea37.js";import"./plugin-744af617.js";import"./settingStore-07be61e1.js";import"./screenApi-6aa52476.js";const D={class:"go-edit"},H=c("页面在线编辑器"),M=c(" 导入 "),$=c(" 「页面失焦保存」 "),j=c(" 「ctrl + s 保存」 "),q=E({__name:"index",setup(G){const{ChevronBackOutlineIcon:K,DownloadIcon:f}=R.ionicons5,l=window.showOpenFilePicker,a=N("");async function g(){const e=await P();F(`编辑-${e.editCanvasConfig.projectName}`),a.value=p(e)}setTimeout(g);async function w(){const i=await(await l())[0].getFile(),s=new FileReader;s.readAsText(i),s.onloadend=()=>{a.value=(s.result||"").toString()}}window.opener.addEventListener(m.CHART,e=>{I(J.GO_CHART_STORAGE_LIST,[e.detail]),a.value=p(e.detail)}),document.addEventListener("keydown",function(e){e.keyCode==83&&(navigator.platform.match("Mac")?e.metaKey:e.ctrlKey)&&(e.preventDefault(),d())}),addEventListener("blur",d);async function d(){if(!window.opener)return window.$message.error("源窗口已关闭，视图同步失败");try{const e=A(a.value);delete e.id,window.opener.dispatchEvent(new CustomEvent(m.JSON,{detail:e}))}catch(e){window.$message.error("内容格式有误"),console.log(e)}}return(e,i)=>{const s=o("n-text"),v=o("n-icon"),y=o("n-button"),_=o("n-tag"),S=o("n-space"),b=o("n-layout-header"),x=o("n-layout-content"),h=o("n-layout");return u(),O("div",D,[t(h,null,{default:n(()=>[t(b,{class:"go-edit-header go-px-5 go-flex-items-center",bordered:""},{default:n(()=>[T("div",null,[t(s,{class:"go-edit-title go-mr-4"},{default:n(()=>[H]),_:1}),r(l)?(u(),V(y,{key:0,class:"go-mr-3",size:"medium",onClick:w},{icon:n(()=>[t(v,null,{default:n(()=>[t(r(f))]),_:1})]),default:n(()=>[M]),_:1})):B("",!0)]),t(S,null,{default:n(()=>[t(_,{bordered:!1,type:"warning"},{default:n(()=>[$]),_:1}),t(_,{bordered:!1,type:"warning"},{default:n(()=>[j]),_:1})]),_:1})]),_:1}),t(x,null,{default:n(()=>[t(r(k),{modelValue:a.value,"onUpdate:modelValue":i[0]||(i[0]=C=>a.value=C),language:"json",editorOptions:{lineNumbers:"on",minimap:{enabled:!0}}},null,8,["modelValue"])]),_:1})]),_:1})])}}});const ne=L(q,[["__scopeId","data-v-dc26cb60"]]);export{ne as default};
