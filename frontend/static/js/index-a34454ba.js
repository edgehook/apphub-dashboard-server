import{d as j,bx as S,bz as Q,ba as o,o as s,c as O,w as a,f as e,q as x,b8 as c,e as t,bs as p,ds as le,bf as X,bg as G,bH as Z,bC as V,bB as ee,bL as ae,bA as B,bb as re,bc as ue,bD as ie,bK as _e,dO as pe,bJ as W,eG as me,ew as fe}from"./.pnpm-ce7dda7b.js";import{_ as J,u as de,av as N,B as Y,ar as ne,D as M,g as ge,R as oe,a8 as he,a9 as ve}from"./index-b6608134.js";import{i as K}from"./icon-7d63310d.js";import{S as H,t as F}from"./index-54633a7f.js";import{u as te}from"./useTargetData.hook-ac6d967b.js";import{g as ce}from"./plugin-744af617.js";import"./index-ce999aec.js";import{R as be,a as ye}from"./pondIndex.vue_vue_type_style_index_0_scoped_de860d6d_lang-527b36d4.js";import"./EditorWorker-ca19246c.js";import{r as qe}from"./chartEditStore-0a96ea37.js";import{C as we}from"./index-f2232116.js";import"./index-18fcb4c8.js";import"./index.vue_vue_type_script_setup_true_lang-b36c4261.js";import"./settingStore-07be61e1.js";import"./file-6db2fad1.js";const xe={class:"go-pr-3"},De=p("名称："),Pe={key:1},Ie=p("取消"),Ce=p("保存"),ke=j({__name:"pondIndex",props:{modelShow:Boolean,targetDataRequest:Object},emits:["update:modelShow","editSaveHandle"],setup(l,{emit:y}){const k=l;S();const g=S(),b=S(!1);Q(()=>k.modelShow,f=>{b.value=f});const D=()=>{y("update:modelShow",!1)},r=()=>{if(!k.targetDataRequest?.dataPondName){window.$message.warning("请在左下角输入名称！"),g.value?.focus();return}ce({message:"保存内容将同步修改所有使用此接口的组件, 是否继续?",isMaskClosable:!0,transformOrigin:"center",onPositiveCallback:()=>{y("update:modelShow",!1),y("editSaveHandle",k.targetDataRequest)}})};return(f,_)=>{const I=o("n-space"),q=o("n-scrollbar"),d=o("n-tag"),h=o("n-input"),v=o("n-button"),P=o("n-card"),R=o("n-modal");return s(),O(R,{class:"go-chart-data-request",show:b.value,"onUpdate:show":_[1]||(_[1]=C=>b.value=C),"mask-closable":!1,closeOnEsc:!1},{default:a(()=>[e(P,{bordered:!1,role:"dialog",size:"small","aria-modal":"true",style:{width:"1000px",height:"800px"}},{header:a(()=>[]),"header-extra":a(()=>[]),action:a(()=>[e(I,{justify:"space-between"},{default:a(()=>[l.targetDataRequest?(s(),O(I,{key:0},{default:a(()=>[e(d,{bordered:!1,type:"primary"},{default:a(()=>[De]),_:1}),e(h,{value:l.targetDataRequest.dataPondName,"onUpdate:value":_[0]||(_[0]=C=>l.targetDataRequest.dataPondName=C),ref_key:"inputInstRef",ref:g,type:"text",size:"small",autofocus:!0,clearable:!0,minlength:1,maxlength:16,placeholder:"请输入名称"},null,8,["value"])]),_:1})):(s(),x("span",Pe)),e(I,null,{default:a(()=>[e(v,{onClick:D},{default:a(()=>[Ie]),_:1}),e(v,{type:"primary",onClick:r},{default:a(()=>[Ce]),_:1})]),_:1})]),_:1})]),default:a(()=>[e(q,{style:{"max-height":"718px"}},{default:a(()=>[c("div",xe,[e(I,{vertical:""},{default:a(()=>[e(t(be)),e(t(ye),{"target-data-request":l.targetDataRequest?.dataPondRequestConfig},null,8,["target-data-request"])]),_:1})])]),_:1})]),_:1})]),_:1},8,["show"])}}}),$e=J(ke,[["__scopeId","data-v-de860d6d"]]),Se=""+new URL("../png/noData.png",import.meta.url).href,Re=l=>(re("data-v-5a44f257"),l=l(),ue(),l),Oe={class:"go-chart-data-pond-list"},Ee={class:"pond-item-box"},He=Re(()=>c("span",null," 创建 ",-1)),Te=p(" 暂无数据内容， "),Ue=p("立即创建"),ze=["onClick"],Ne={class:"item-content"},Be={class:"item-content-body"},Ae=p(" 名称 "),Le=p(" 地址 "),Fe=["onClick"],je=j({__name:"index",emits:["createPond","deletePond"],setup(l,{emit:y}){le(v=>({"1fc68d8a":t(I)}));const{DuplicateOutlineIcon:k,TrashIcon:g}=K.ionicons5,b=de(),{chartEditStore:D,targetData:r}=te(),{requestDataPond:f}=X(D.getRequestGlobalConfig),_=G(()=>r.value.request.requestDataPondId),I=G(()=>b.getAppTheme),q=()=>{y("createPond",!0)},d=(v,P)=>{v.stopPropagation(),v.preventDefault(),y("deletePond",P)},h=v=>{r.value.request.requestDataPondId=v.dataPondId};return(v,P)=>{const R=o("n-timeline-item"),C=o("n-timeline"),w=o("n-icon"),U=o("n-button"),T=o("n-divider"),n=o("n-a"),u=o("n-text"),i=o("n-space"),E=o("n-tag"),$=o("n-ellipsis"),z=o("n-scrollbar");return s(),x("div",Oe,[e(C,{style:{width:"20px"}},{default:a(()=>[e(R,{type:"info"}),e(R,{type:"success"})]),_:1}),c("div",Ee,[e(U,{class:"create-btn go-py-4",ghost:"",onClick:q},{icon:a(()=>[e(w,null,{default:a(()=>[e(t(k))]),_:1})]),default:a(()=>[He]),_:1}),e(T,{style:{margin:"10px 0"}}),t(f).length?Z("",!0):(s(),O(i,{key:0,justify:"center"},{default:a(()=>[e(u,{class:"not-layer-text",depth:3},{default:a(()=>[Te,e(n,{onClick:q},{default:a(()=>[Ue]),_:1})]),_:1})]),_:1})),e(z,{style:{"max-height":"490px"}},{default:a(()=>[(s(!0),x(V,null,ee(t(f),m=>(s(),x("div",{key:m.dataPondId,class:ae([{select:m.dataPondId===t(_)},"pond-item"]),onClick:A=>h(m)},[c("div",Ne,[c("div",Be,[c("div",null,[e(E,{class:"go-mr-1",type:m.dataPondId===t(_)?"warning":"",bordered:!1},{default:a(()=>[Ae]),_:2},1032,["type"]),e($,{style:{"max-width":"180px"}},{default:a(()=>[p(B(m.dataPondName||"暂无"),1)]),_:2},1024)]),c("div",null,[e(E,{class:"go-mr-1",type:m.dataPondId===t(_)?"warning":"",bordered:!1},{default:a(()=>[Le]),_:2},1032,["type"]),e($,{style:{"max-width":"180px"}},{default:a(()=>[p(B(m.dataPondRequestConfig.requestUrl||"暂无"),1)]),_:2},1024)])]),c("div",{class:"item-content-icon go-transition-quick",onClick:A=>d(A,m)},[e(w,null,{default:a(()=>[e(t(g))]),_:1})],8,Fe)]),c("div",{class:ae({"select-modal":m.dataPondId===t(_)})},null,2)],10,ze))),128))]),_:1})])])}}});const Me=J(je,[["__scopeId","data-v-5a44f257"]]),Ge=c("thead",null,[c("tr",null,[c("th",null,"key"),c("th",null,"value")])],-1),se=j({__name:"displayTable",props:{target:Object},setup(l){const y=l,k={key:"",value:""},g=ie({content:[]});return Q(()=>y.target,b=>{g.content=[];for(const D in b)g.content.push({key:D,value:b[D]});g.content.length||(g.content=[JSON.parse(JSON.stringify(k))])},{immediate:!0,deep:!0}),(b,D)=>{const r=o("n-table");return s(),O(r,{bordered:!1,"single-line":!1,size:"small",style:{"border-bottom-right-radius":"7px","border-bottom-left-radius":"7px"}},{default:a(()=>[Ge,c("tbody",null,[(s(!0),x(V,null,ee(g.content,(f,_)=>(s(),x("tr",{key:_},[c("td",null,B(f.key||"暂无"),1),c("td",null,B(f.value||"暂无"),1)]))),128))])]),_:1})}}}),Ve={class:"go-chart-data-display"},Je={class:"go-mr-3"},Ye={key:0},Qe={class:"go-mt-3"},We={key:0},Xe={key:1},Ke=p("该接口没有 Body 体"),Ze={key:1},et=p("sql"),tt=j({__name:"index",props:{globalData:Object,targetData:Object},setup(l){const y=l,{HelpOutlineIcon:k,FlashIcon:g,PulseIcon:b}=K.ionicons5,{requestUrl:D,requestInterval:r,requestHttpType:f,requestContentType:_,requestSQLContent:I,requestParams:q,requestParamsBodyType:d,requestIntervalUnit:h}=X(y.targetData.dataPondRequestConfig);N.HEADER;const v={[Y.DEFAULT]:"普通请求",[Y.SQL]:"SQL 请求"},P=S(N.PARAMS);return(R,C)=>{const w=o("n-input"),U=o("n-icon"),T=o("n-divider"),n=o("n-tab"),u=o("n-tabs"),i=o("n-text"),E=o("n-card"),$=o("n-code"),z=o("n-scrollbar");return s(),x("div",Ve,[e(z,{style:{"max-height":"570px"}},{default:a(()=>[c("div",Je,[c("div",null,[e(t(H),{name:"主体信息"},{default:a(()=>[e(t(F),{name:"接口名称"},{default:a(()=>[e(w,{size:"small",placeholder:l.targetData?.dataPondName||"暂无",disabled:!0},null,8,["placeholder"])]),_:1}),e(t(F),{name:"接口类型"},{default:a(()=>[e(w,{size:"small",placeholder:t(f)||"暂无",disabled:!0},null,8,["placeholder"])]),_:1})]),_:1}),e(t(H),null,{default:a(()=>[e(t(F),{name:"组件间隔"},{default:a(()=>[e(w,{size:"small",placeholder:`${t(r)||"暂无"}`,disabled:!0},{suffix:a(()=>[p(B(l.targetData&&t(ne)[t(h)]),1)]),_:1},8,["placeholder"])]),_:1}),e(t(F),{name:"全局间隔（默认）"},{default:a(()=>[e(w,{size:"small",placeholder:`${l.globalData?.requestInterval||"暂无"}`,disabled:!0},{suffix:a(()=>[p(B(l.globalData&&t(ne)[l.globalData.requestIntervalUnit]),1)]),_:1},8,["placeholder"])]),_:1})]),_:1}),e(t(H),{name:"源地址",alone:!0},{default:a(()=>[e(w,{size:"small",placeholder:l.globalData?.requestOriginUrl||"暂无",disabled:!0},{prefix:a(()=>[e(U,{component:t(b)},null,8,["component"])]),_:1},8,["placeholder"])]),_:1}),e(t(H),{name:"接口地址",alone:!0},{default:a(()=>[e(w,{size:"small",placeholder:t(D)||"暂无",disabled:!0},{prefix:a(()=>[e(U,{component:t(g)},null,8,["component"])]),_:1},8,["placeholder"])]),_:1})]),e(T),e(t(H),{name:"类型"},{default:a(()=>[e(t(F),{name:"配置类型"},{default:a(()=>[e(w,{size:"small",placeholder:l.targetData&&v[t(_)],disabled:!0},null,8,["placeholder"])]),_:1}),t(_)===t(Y).DEFAULT?(s(),O(t(F),{key:0,name:"body 类型"},{default:a(()=>[e(w,{size:"small",placeholder:l.targetData&&t(d),disabled:!0},null,8,["placeholder"])]),_:1})):Z("",!0)]),_:1}),t(_)===t(Y).DEFAULT?(s(),x("div",Ye,[e(u,{type:"line",animated:"",value:P.value,"onUpdate:value":C[0]||(C[0]=m=>P.value=m)},{default:a(()=>[(s(!0),x(V,null,ee(t(N),m=>(s(),O(n,{key:m,name:m,tab:m},{default:a(()=>[p(B(m),1)]),_:2},1032,["name","tab"]))),128))]),_:1},8,["value"]),c("div",Qe,[P.value!==t(N).BODY?(s(),x("div",We,[e(se,{class:"go-my-3",target:t(q)[P.value]},null,8,["target"])])):(s(),x("div",Xe,[t(d)===t(M).NONE?(s(),O(E,{key:0,class:"go-mt-3 go-pb-3"},{default:a(()=>[e(i,{depth:"3"},{default:a(()=>[Ke]),_:1})]),_:1})):t(d)===t(M).FORM_DATA||t(d)===t(M).X_WWW_FORM_URLENCODED?(s(),O(se,{key:1,class:"go-my-3",target:t(q)[t(N).BODY][t(d)]},null,8,["target"])):t(d)===t(M).JSON?(s(),O(E,{key:2,size:"small",style:{"padding-bottom":"7px"}},{default:a(()=>[e($,{code:t(q)[t(N).BODY][t(d)]||"暂无内容",language:"json"},null,8,["code"])]),_:1})):t(d)===t(M).XML?(s(),O($,{key:3,code:t(q)[t(N).BODY][t(d)]||"",language:"html"},null,8,["code"])):Z("",!0)]))])])):(s(),x("div",Ze,[e(t(H),{name:"键名"},{default:a(()=>[e(i,null,{default:a(()=>[et]),_:1})]),_:1}),e(t(H),{name:"键值"},{default:a(()=>[e($,{code:t(I).sql||"",language:"sql"},null,8,["code"])]),_:1})]))])]),_:1})])}}});const at=J(tt,[["__scopeId","data-v-cc877db2"]]),nt={class:"pond-content"},ot={key:1,class:"no-data go-flex-center"},st=["src"],lt=p("暂未选择公共接口"),dt=p(" 编辑内容 "),ct=p("保存 & 发送请求"),rt=j({__name:"index",props:{modelShow:Boolean},emits:["update:modelShow","sendHandle"],setup(l,{emit:y}){const k=l,{PencilIcon:g}=K.ionicons5,{chartEditStore:b,targetData:D}=te(),{requestDataPond:r}=X(b.getRequestGlobalConfig),f=S(!1),_=S(!1),I=S(!1),q=S(!1),d=S(),h=G(()=>{const n=D?.value?.request?.requestDataPondId;return n?r.value.filter(i=>n===i.dataPondId)[0]:void 0});Q(()=>k.modelShow,n=>{_.value=n}),Q(()=>h.value,n=>{I.value=!0,d.value=n,_e(()=>{I.value=!1})},{immediate:!0});const v=(n=!1)=>{q.value=!!n,f.value=!0},P=()=>{const n=ge();d.value={dataPondId:n,dataPondName:n,dataPondRequestConfig:pe.cloneDeep({...qe,requestDataType:oe.Pond})},v()},R=n=>{q.value?C(n):w(n),q.value=!1,f.value=!1},C=n=>{try{const u=r.value.findIndex(i=>i.dataPondId===n.dataPondId);u!==-1?(r.value.splice(u,1,n),b.getComponentList.forEach(i=>{i.request.requestDataType===oe.Pond&&i.request.requestDataPondId===n.dataPondId&&(i.request={...W(n.dataPondRequestConfig),requestDataPondId:n.dataPondId})}),window.$message.success("保存成功！")):window.$message.error("编辑失败，请稍后重试！")}catch{window.$message.error("编辑失败，请稍后重试！")}},w=n=>{try{d.value?(r.value.unshift(n),window.$message.success("创建成功!")):window.$message.error("创建失败，请稍后重试!")}catch{window.$message.error("创建失败，请稍后重试!")}},U=n=>{ce({message:"删除数据后，需手动处理使用改接口的组件，是否继续？",isMaskClosable:!0,transformOrigin:"center",onPositiveCallback:()=>{const u=r.value.findIndex(i=>i.dataPondId===n.dataPondId);u!==-1?(r.value.splice(u,1),window.$message.success("删除成功!")):window.$message.error("删除失败，请稍后重试！")}})},T=()=>{h.value&&(D.value.request={...W(h.value.dataPondRequestConfig),requestDataPondId:h.value.dataPondId}),y("update:modelShow",!1),y("sendHandle")};return(n,u)=>{const i=o("n-text"),E=o("n-icon"),$=o("n-button"),z=o("n-space"),m=o("n-card"),A=o("n-modal");return s(),x(V,null,[e(A,{class:"go-chart-data-pond-control",show:_.value,"onUpdate:show":u[1]||(u[1]=L=>_.value=L),"mask-closable":!1},{default:a(()=>[e(m,{bordered:!1,role:"dialog",size:"small","aria-modal":"true",style:{width:"900px",height:"650px"}},{header:a(()=>[]),"header-extra":a(()=>[]),action:a(()=>[e(z,{justify:"space-between"},{default:a(()=>[e($,{type:"info",secondary:"",disabled:!t(h),onClick:u[0]||(u[0]=L=>v(!0))},{icon:a(()=>[e(E,null,{default:a(()=>[e(t(g))]),_:1})]),default:a(()=>[dt]),_:1},8,["disabled"]),e($,{type:"primary",onClick:T},{default:a(()=>[ct]),_:1})]),_:1})]),default:a(()=>[c("div",nt,[t(h)&&!I.value?(s(),O(t(at),{key:0,targetData:t(h),globalData:t(b).getRequestGlobalConfig},null,8,["targetData","globalData"])):(s(),x("div",ot,[c("img",{src:t(Se),alt:"暂无数据"},null,8,st),e(i,{depth:3},{default:a(()=>[lt]),_:1})])),e(t(Me),{onCreatePond:P,onDeletePond:U})])]),_:1})]),_:1},8,["show"]),e(t($e),{modelShow:f.value,"onUpdate:modelShow":u[2]||(u[2]=L=>f.value=L),targetDataRequest:d.value,isEdit:q.value,onEditSaveHandle:R},null,8,["modelShow","targetDataRequest","isEdit"])],64)}}});const ut=J(rt,[["__scopeId","data-v-f251a5df"]]),it={class:"go-chart-data-pond"},_t={class:"go-absolute-center"},pt=p("编辑配置"),mt=p(" 测试 "),ft=p(" 默认赋值给 dataset 字段 "),gt=p(" 发送请求 "),ht=j({__name:"index",setup(l){le(n=>({"0870c238":t(w)}));const y=de(),{HelpOutlineIcon:k,FlashIcon:g,PulseIcon:b,FishIcon:D}=K.ionicons5,{targetData:r,chartEditStore:f}=te(),{requestDataPond:_,requestInterval:I,requestIntervalUnit:q}=X(f.getRequestGlobalConfig),d=S(!1),h=S(!1),v=S(!1);let P=0,R;const C=G(()=>{const n=r.value.request.requestDataPondId;return n?_.value.filter(i=>n===i.dataPondId)[0]:void 0}),w=G(()=>y.getAppTheme),U=()=>{h.value=!0},T=async()=>{if(!r.value?.request){window.$message.warning("请选择一个公共接口！");return}d.value=!0;try{const n=await he(W(r.value.request),W(f.getRequestGlobalConfig));if(d.value=!1,n){!n?.data&&!r.value.filter&&window.$message.warning("您的数据不符合默认格式，请配置过滤器！"),r.value.option.dataset=ve(n?.data,n,r.value.filter),v.value=!0;return}window.$message.warning("数据异常，请检查参数！")}catch{d.value=!1,window.$message.warning("数据异常，请检查参数！")}};return me(()=>{const n=r.value?.filter;R!==n&&P&&(R=n,T()),P++}),fe(()=>{R=null}),(n,u)=>{const i=o("n-icon"),E=o("n-input"),$=o("n-button"),z=o("n-card"),m=o("n-tooltip"),A=o("go-skeleton");return s(),x(V,null,[c("div",it,[e(z,{class:"n-card-shallow"},{default:a(()=>[e(t(H),{name:"请求名称",alone:!0},{default:a(()=>[e(E,{size:"small",placeholder:t(C)?.dataPondName||"暂无",disabled:!0},{prefix:a(()=>[e(i,{component:t(D)},null,8,["component"])]),_:1},8,["placeholder"])]),_:1}),e(t(H),{name:"接口地址",alone:!0},{default:a(()=>[e(E,{size:"small",placeholder:t(C)?.dataPondRequestConfig.requestUrl||"暂无",disabled:!0},{prefix:a(()=>[e(i,{component:t(g)},null,8,["component"])]),_:1},8,["placeholder"])]),_:1}),c("div",{class:"edit-text",onClick:U},[c("div",_t,[e($,{type:"primary",secondary:""},{default:a(()=>[pt]),_:1})])])]),_:1})]),e(t(H),{alone:!0},{name:a(()=>[mt,e(m,{trigger:"hover"},{trigger:a(()=>[e(i,{size:"21",depth:3},{default:a(()=>[e(t(k))]),_:1})]),default:a(()=>[ft]),_:1})]),default:a(()=>[e($,{type:"primary",ghost:"",onClick:T},{icon:a(()=>[e(i,null,{default:a(()=>[e(t(g))]),_:1})]),default:a(()=>[gt]),_:1})]),_:1}),e(t(we),{show:v.value&&!d.value,ajax:!0},null,8,["show"]),e(A,{load:d.value,repeat:3},null,8,["load"]),e(t(ut),{modelShow:h.value,"onUpdate:modelShow":u[0]||(u[0]=L=>h.value=L),onSendHandle:T},null,8,["modelShow"])],64)}}});const Et=J(ht,[["__scopeId","data-v-b30eea06"]]);export{Et as default};
